\documentclass[12pt, letterpaper]{extarticle}
\usepackage[utf8]{inputenc}
\usepackage[T2A,T1]{fontenc}
\usepackage[english, russian]{babel}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{hyperref}
\hypersetup{colorlinks=true,linkcolor=blue,filecolor=magenta,urlcolor=cyan,}
\pagenumbering{gobble}
\usepackage[left=1cm, top=1cm, right=1cm, bottom=1cm, nohead, nofoot]{geometry}
\title{\textbf{ОБЩИЕ АБСТРАКТНЫЕ ПРЕДСТАВЛЕНИЯ}}
\author{\href{https://web.archive.org/web/20170629072301/http://www.genfunc.ru/theory/rsol/}{genfunc.ru(18.03.2018)}}
\date{давным-давно в далёкой галактике}

\everymath{\displaystyle}

\begin{document}
\maketitle
Производящие функции наиболее часто применяются при решении рекуррентных соотношений. Рекуррентные соотношения, в свою очередь, часто возникают в дискретной математике и комбинаторике, поэтому \textbf{метод производящих функций} для решения рекуррентных соотношений изучают именно в рамках этих дисциплин. Самые \textbf{простые примеры решения рекуррентных соотношений} приводятся в этой лекции. Более сложные примеры — в последующих лекция.
\begin{center}
  \textbf{ОБЩАЯ СХЕМА}
\end{center}

Пусть последовательность $(a_0, a_1, a_2, \dots)$ удовлетворяет некоторому рекуррентному соотношению. Мы хотим получить выражение для $a_n$ (при $n\geq0$) в замкнутом виде (если это возможно). Производящие функции позволяют делать эту работу почти механически по одному и тому же алгоритму. Рассмотрим общую схему на простом примере, который позволит продемонстрировать базовые приёмы работы.

Задано линейное однородное рекуррентное соотношение порядка $2$ с постоянными коэффициентами:
\[a_0=0\]
\[a_1=1\]
\[a_n=5a_{n-1}-6a_{n-2}\]

Порядок соотношения -- это его <<глубина>>, то есть количество предшествующих элементов, требуемых для вычисления элемента с номером $n$. В данном случае порядок равен $2$, так как для вычисления $a_n$ требуется знать $a_{n-1}$ и $a_{n-2}$.

Попытаемся для начала <<угадать>> ответ:

\begin{center}
  \begin{tabular}{| c | c | c | c | c | c |}
    \hline
    $n$ & $0$ & $1$ & $2$ & $3$ & $4$ \\
    \hline
    $a_n$ & $0$ & $1$ & $5$ & $19$ & $65$\\
    \hline
  \end{tabular}
\end{center}

по данной таблице трудно что-либо сказать сразу, если вы, конечно, не видели этой последовательности раньше и не обладаете достаточным опытом разгадывания такого рода комбинаций. Значит самое время воспользоваться техникой производящий функций.

Будем искать \textbf{производящую функцию последовательности} в виде
\[G(z)=\sum_{n=0}^{\infty}a_nz^n=a_0+a_1z+a_2z^2+\cdots\]
с этой целью умножим верхнюю строчку в записи рекуррентного соотношения на $z_0$, следующую — на $z_1$ и последнюю — на $z_n$:
\[a_0z^0=0\]
\[a_1z^1=z^1\]
\[a_nz^n=5a_{n-1}z^n-6a_{n-2}z^n\]

Теперь сложим все уравнения для всех значений $n$:
\[a_0+a_0z+\sum_{n=2}^{\infty}a_nz^n=z+\sum_{n=2}^{\infty}5a_{n-1}z^n-\sum_{n=2}^{\infty}6a_{n-2}z^{n}\]
Левая часть уравнения в точности равна $G(z)$, а в правой части есть суммы, очень похожие на функцию $G(z)$, но не равные ей. Эти суммы нужно любым законным способом (используя правила работы с алгебраическими выражениями) привести к виду $G(z)$. Начнём с первой:
\[G(z)=z+5z\sum_{n=1}^{\infty}a_nz^n-6z^2\sum_{n=0}^{\infty}a_nz^n=z+5zG(z)-6z^2G(z)\]
\[G(z)=\frac{z}{1-5z+6z^2}\]

Отыскав производящую функцию в замкнутом виде, её нужно снова разложить в ряд. Это можно сделать разными способами, но самый простой из них — разбить всю дробь на простые дроби и применить формулу для разложения $\frac{1}{1-z}$. Итак, разложим знаменатель функции на множители:
\[G(z)=\frac{z}{1-5z+6z^2}=\frac{z}{(1-3z)(1-2z)}\]
Теперь разобьём дробь на сумму простых дробей:
\[\frac{z}{(1-3z)(1-2z)}=-\frac{1}{1-3z}-\frac{1}{1-2z}\]

Вспомним разложение для простейшей рациональной функции:
\[\frac{1}{1-z}=\sum_{n=0}^{\infty}z^n=1+z+z^2+z^3+\cdots\]
Из этого разложения следует, что (см. также таблицу производящих функций)
\[\frac{1}{1-3z}=\sum_{n=0}^{\infty}(3z)^n\]
\[\frac{1}{1-2z}=\sum_{n=0}^{\infty}(2z)^n\]
Таким образом,
\[G(z)=\sum_{n=0}^{\infty}3^nz^n-\sum_{n=0}^{\infty}2^nz^n=\sum_{n=0}^{\infty}(3^n-2^n)z^n\]
С другой стороны, мы искали $G(z)$ в виде
\[G(z)=\sum_{n=0}^{\infty}a_nz^n\]
поэтому, в силу равенства рядов, $a_n=3^n-2^n$ (для $n\geq0$). Теперь скажите: как проверить правильность полученного ответа?
\begin{center}
  \textbf{АЛГОРИТМ}
\end{center}

Алгоритм получения замкнутого выражения для чисел $a_n$, удовлетворяющих рекуррентному соотношению, с помощью производящих функций состоит из $4$ шагов.

\begin{enumerate}
  \item Записать рекуррентное соотношение и начальные данные для него в следующем виде (если порядок соотношения равен $k$):
  \[a_0=\dots\]
  \[a_1=\dots\]
  \[\cdots\]
  \[a_n=\cdots\quad n\geq k\]
  \item Домножить каждую строчку на $z$ в соответствующей степени и просуммировать строчки для всех $n\geq0$.
  \item В полученном уравнении привести все суммы $\Sigma$ к замкнутому виду. Получить уравнение для производящей функции.
  \item Выразить $G(z)$ в явном виде (решить уравнение, полученное на предыдущем шаге) и разложить производящую функцию в ряд по степеням $z$.
\end{enumerate}

\begin{center}
  \textbf{ЧИСЛА ФИБОНАЧЧИ}
\end{center}

Это классический пример, который приводят почти везде, где речь идет о решении рекуррентных соотношений. Рассмотрим \textbf{рекуррентное соотношение для чисел Фибоначчи}:
\[f_0=0\]
\[f_1=1\]
\[f_n=f_{n-1}+f_{n-2}\quad n\geq2\]
Это хорошо известная последовательность, каждый элемент которой (кроме нулевого и первого) равен сумме двух предыдущих:

\begin{center}\begin{tabular}{|c|c c c c c c c c c c|}
  \hline
  $n$ & $0$ & $1$ & $2$ & $3$ & $4$ & $5$ & $6$ & $7$ & $8$ & $9$ \\
  \hline
  $f_n$ & $0$ & $1$ & $1$ & $2$ & $3$ & $5$ & $8$ & $13$ & $21$ & $34$ \\
  \hline
\end{tabular}\end{center}
Эти числа очень быстро растут, например:
\begin{center}\begin{tabular}{c}
  $f_{10}=55$ \\ $f_{20}=6765$ \\ $f_{30}=832040$ \\ $f_{100}=354224848179261915075$
\end{tabular}\end{center}

Первый шаг алгоритма мы уже выполнили, записав рекуррентное соотношение. Выполним второй шаг:
\[1\cdot f_0=0\cdot 1\]
\[z\cdot f_1=1\cdot z\]
\[z^n\cdot f_{n}=(f_{n-1}+f_{n-2})\cdot z^n\]
Складываем все строчки
\[f_0+f_1+\sum_{n=2}^{\infty}f_nz^n=0+z+\sum_{n=2}^{\infty}f_{n-1}z^n+\sum_{n=2}^{\infty}f_{n-2}z^n=z+z\sum_{n=1}^{\infty}f_nz^n+z^2\sum_{n=0}^{\infty}f_nz^n=z+zG(z)+z^2G(z)\]
откуда получаем замкнутое выражение для производящей функции:
\[G(z)=\frac{z}{1-z-z^2}\]
Осталось <<всего лишь>> разложить её в ряд (чего требует четвёртый шаг алгоритма). С этой целью нужно разложить знаменатель на множители. Найдем корни уравнения:
\[1-z-z^2=0\]
\[z_1=-\frac{1-\sqrt{5}}{2}\qquad z_2=-\frac{1+\sqrt{5}}{2}\]
Таким образом (проверьте),
\[G(z)=\frac{z}{1-z-z^2}=\frac{-z}{(z_1-z)(z_2-z)}=\frac{z_1/(z_1-z_2)}{z_1-z}+\frac{z_2/(z_2-z_1)}{z_2-z}\]

Как теперь поступить с этими выражениями? Ведь пока нам известно разложение только одной рациональной функции:
\[\frac{1}{1-z}=\sum_{n=0}^{\infty}z^n=1+z+z^2+z^3+\cdots\]
Рассмотрим первую дробь и поделим в ней числитель и знаменатель на $z1$:
\[\frac{z_1/(z_1-z_2)}{z_1-z}=\frac{1}{z_1-z_2}\frac{1}{1-\frac{z}{z_1}}=\frac{1}{z_1-z_2}\sum_{n=0}^{\infty}\frac{z^n}{z_1^n}\]
Аналогично (но с делением на $z2$) поступим со второй дробью:
\[\frac{z_2/(z_2-z_1)}{z_2-z}=\frac{1}{z_2-z_1}\frac{1}{1-\frac{z}{z_2}}=\frac{1}{z_2-z_1}\sum_{n=0}^{\infty}\frac{z^n}{z_2^n}\]
Таким образом,
\[G(z)=\sum_{n=0}^{\infty}f_nz^n=\frac{z_1/(z_1-z_2)}{z_1-z}+\frac{z_2/(z_2-z_1)}{z_2-z}=\frac{1}{z_1-z_2}\sum_{n=0}^{\infty}\frac{z^n}{z_1^n}+\frac{1}{z_2-z_1}\sum_{n=0}^{\infty}\frac{z^n}{z_2^n}\]
и, следовательно,
\[f_n=\frac{1}{z_1-z_2}\frac{1}{z_1^n}+\frac{1}{z_2-z_1}\frac{1}{z_2^n}\]
Данное выражение можно <<причесать>>, если обратить внимание на то, что $\frac{1}{z_1}=-z_2$, $\frac{1}{z_2}=-z_1$ и $z_1-z_2=\sqrt{5}$:
\[f_n=\frac{1}{\sqrt{5}}\left( \biggl( \frac{1+\sqrt{5}}{2} \biggr)^n - \biggl( \frac{1-\sqrt{5}}{2} \biggr)^n \right).\]

Если записывать формулу в терминах хорошо известного <<золотого сечения>>
\[\phi=\frac{1+\sqrt{5}}{2}\]
то, обозначив $\hat{\phi}=1-\phi$, получим
\[f_n= \frac{\phi^n - \hat\phi^n}{\sqrt{5}}.\]
Если <<золотое сечение>> не использовать, то лучше всего формула выглядит в следующем виде:
\[f_n = \frac{(1+\sqrt{5})^n - (1-\sqrt{5})^n}{2^n\sqrt{5}}\]
чего достаточно трудно было ожидать, глядя на красивое исходное рекуррентное соотношение.

Обязательно проверьте формулу хотя бы для $n=0, 1, 2$. Как изменится производящая функция и конечная формула, если положить $f0=f1=1$?
\begin{center}
  \textbf{БОЛЕЕ СЛОЖНОЕ СООТНОШЕНИЕ}
\end{center}

Рассмотрим довольно произвольное рекуррентное соотношение:

\[\begin{array}{rcl}
a_0&{}={}&1,\\
a_1&{}={}&2,\\
a_n&{}={}&6a_{n-1}-8f_{n-2}+n, \quad n\geq2.\\
\end{array}\]

Рассчитаем несколько первых элементов:

\begin{center}\begin{tabular}{| c | c | c | c | c | c |}
  \hline
  $n$ & $0$ & $1$ & $2$ & $3$ & $4$ \\
  \hline
  $a_n$ & $1$ & $2$ & $6$ & $23$ & $94$ \\
  \hline
\end{tabular}\end{center}

Несколько следующих действий мы выполним без пояснений, поскольку они абсолютно аналогичны тем, которые уже делались раньше:
\[
  \begin{array}{rcl}
    a_0+a_1z+\sum_{n=0}^{\infty}a_nz^n&=& 1+2z+6\sum_{n=2}^{\infty}a_{n-1}z^n-8\sum_{n=2}^{\infty}a_{n-2}z^n+\sum_{n=2}^{\infty}nz^n \\\\
    G(z) &=& 1+2z+6z\sum_{n=1}^{\infty}a_nz^n-8z^2\sum_{n=0}^{\infty}a_nz^n+\sum_{n=2}^{\infty}nz^n \\\\
    G(z) &=& 1+2z+6z\left(G(z)-a_0\right)-8z^2G(z)+\sum_{n=2}^{\infty}nz^n \\\\
    G(z) &=& 1-4z+6zG(z)-8z^2G(z)+\sum_{n=2}^{\infty}nz^n \\\\
  \end{array}
\]
Пока непонятно, что делать с последней суммой. Как её <<замкнуть>>? На самом деле, очень просто, если вспомнить про производную (подробнее см. лекцию <<Преобразование производящих функций: полиномиальный множитель и делитель>>):
\[(z^n)'=nz^{n-1}\]
поэтому
\[\sum_{n=2}^{\infty}nz^n=z\sum_{n=2}^{\infty}nz^{n-1}=z\sum_{n=2}^{\infty}\left(z^n\right)'=z\left(\sum_{n=2}^{\infty}z^n\right)'\]
Обратите внимание, что мы вынесли производную за знак бесконечной суммы, не проверив, имеем ли мы на это право. Можно показать, что все сделано законно, но мы не будем этим заниматься сейчас. Последняя сумма может быть свёрнута:
\[\sum_{n=2}^{\infty}z^n=\sum_{n=0}^{\infty}z^n-1-z=\frac{1}{1-z}-1-z=\frac{z^2}{1-z}.\]
Подставив свёрнутое выражение обратно, имеем,
\[z\left(\sum_{n=2}^{\infty}z^n\right)' = z \left(\frac{z^2}{1-z}\right)'=\frac{z^2(2-z)}{(1-z)^2}.\]

Таким образом, наше последнее уравнение примет вид
\[G(z) = 1 -4z + 6zG(z)-8z^2G(z) + \frac{z^2(2-z)}{(1-z)^2}\]
Это уравнение для производящей функции. Из него выражаем $G(z)$:
\[G(z) = \frac{1-6z+11z^2-5z^3}{(1-6z+8z^2)(1-z)^2}\]

Довольно страшное выражение, которое нам предстоит разложить в ряд, на самом деле только кажется таким. Разложим знаменатель на множители и разобьём дробь на сумму простых дробей:
\[G(z) = \frac{1-6z+11z^2-5z^3}{(1-6z+8z^2)(1-z)^2}=\left[\texttt{Очень страшно, мы не знаем, чтo это такое}\right]\]
Дальше мы знаем что делать со всеми этими дробями, кроме, разве лишь, первой. Рассмотрим её (без множителя) подробнее (см. также <<Расширенные биномиальные коэффициенты>>):
\[\frac{1}{(1-z)^2}=(1-z)^{-2}==\sum_{n=0}^{\infty}(n+1)z^n\]
Теперь соберём ответ:

\[G(z) = \frac{1/3}{(1-z)^2}+\frac{7/9}{1-z}-\frac{1/2}{1-2z}...
...\sum_{n=0}^{\infty}2^nz^n
+\frac{7}{18}\sum_{n=0}^{\infty}4^nz^n.\]
Значит,
\[
a_n=\frac{n+1}{3}+\frac{7}{9}-\frac{2^n}{2}+\frac{7\cdot4^n}{18}=\frac{7\cdot4^n+6n+20}{18} - 2^{n-1}\]

Подстановка первых пяти значений совпадает с числами из таблицы, в которую мы их записали в начале.
\end{document}
